using Microsoft.EntityFrameworkCore;
using securityindexAPI.Models;

namespace securityindexAPI.Data
{
    public class ApplicationDbContext : DbContext
    {
        public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options)
            : base(options)
        {
        }

        // 뷰를 매핑하기 위한 DbSet
        public DbSet<관제고객마스터> 관제고객마스터뷰 { get; set; }

        // 관제고객 상세 정보를 위한 뷰 매핑 (같은 뷰 사용)

        // 사용자마스터 테이블 매핑
        public DbSet<사용자마스터> 사용자마스터 { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            // 관제고객상세는 관제관리번호를 키로 설정하여 같은 뷰 사용
            modelBuilder.Entity<관제고객마스터>()
                .ToView("관제고객마스터뷰");
            modelBuilder.Entity<관제고객마스터>()
                .HasKey(c => c.관제관리번호);

            // 사용자마스터 테이블 매핑
            modelBuilder.Entity<사용자마스터>()
                .ToTable("사용자마스터")
                .HasKey(u => u.등록번호);
        }
    }
}
